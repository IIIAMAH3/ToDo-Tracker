{% extends 'todo/base.html' %}
{% load static %}

{% block title %}Create New Task - ToDo Tracker{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'todo/css/todo-form.css' %}">
{% endblock %}

{% block content %}
    <div class="form-page-wrapper" style="max-height: 100%">
        <div class="form-container">
            <div class="form-header">
                <h1 class="form-title">Create New Task</h1>
                <p class="form-subtitle">Add a new task to your todo list</p>
            </div>

            <!-- Display general form errors -->
            {% if error %}
            <div class="error-message" style="background: #fed7d7; padding: 12px; border-radius: 8px; margin-bottom: 20px;">
                {{ error }}
            </div>
            {% endif %}

            <form method="POST">
                {% csrf_token %}

                <div class="form-group">
                    <label for="{{ form.title.id_for_label }}">Task Title *</label>
                    {{ form.title }}
                    {{ form.title.errors }}
                </div>

                 <div class="form-group">
                    <label for="{{ form.description.id_for_label }}">Description</label>
                    {{ form.description }}
                    {{ form.description.errors }}
                  </div>

                <div class="form-group">
                    <label for="{{ form.deadline_datetime.id_for_label }}">Due Date</label>
                    {{ form.deadline_datetime }}
                    {{ form.deadline_datetime.errors }}
                </div>

                <div class="form-group">
                    <label class="checkbox-wrapper">
                        {{ form.important }}
                        <span class="checkmark"></span>
                        <span style="padding-left: 30px">Mark as important</span>
                    </label>
                    {{ form.important.errors }}
                </div>


                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" style="background-color: rgba(17,5,166,0.3)" onclick="window.history.back()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Task</button>
                </div>


            </form>

            <div class="form-footer">
                <p>Fill in the required fields marked with *</p>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add today's date as default for due date
        const today = new Date().toISOString().split('T')[0];
        const dueDateField = document.getElementById('id_deadline_datetime');
        if (dueDateField && !dueDateField.value) {
            dueDateField.value = today;
        }

        // Add focus effects
        const inputs = document.querySelectorAll('.custom-input, .custom-textarea, .custom-select, .custom-date');
        inputs.forEach(input => {
            input.addEventListener('focus', function() {
                this.parentElement.classList.add('focused');
            });

            input.addEventListener('blur', function() {
                this.parentElement.classList.remove('focused');
            });
        });

        // Check current theme and apply if needed
        const currentTheme = localStorage.getItem('theme') || 'light';
        if (currentTheme === 'dark') {
            document.body.classList.add('dark-theme');
        }
    });
</script>
{% endblock %}